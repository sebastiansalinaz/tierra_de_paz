{% extends "layout/layout.html" %}

{% block title %}Eventos{% endblock %}

{% block content %}
<section id="content">
    <!-- CONTENIDO PRINCIPAL -->
    <main>
        <div class="head-title">
            <div class="left">
                <h1>REGISTRO DE USUARIOS</h1>
                <ul class="breadcrumb">
                    <li>
                        <a href="#">Panel de control</a>
                    </li>
                    <li><i class='bx bx-chevron-right'></i></li>
                    <li>
                        <a class="active" href="#">Inicio</a>
                    </li>
                </ul>
            </div>
            <button id="btn-open-modal1" class="btn-evento" onclick="openModal('myModalActivity')">
                <i class='bx bx-calendar-plus'></i>
                <span class="text">Registrar Usuario</span>
            </button>
        </div>

        <ul class="box-info">
            <li>
                <i class='bx bxs-calendar-check'></i>
                <span class="text">
                    <h3>1020</h3>
                    <p>Registros</p>
                </span>
            </li>
            <li>
                <i class='bx bxs-group'></i>
                <span class="text">
                    <h3>2834</h3>
                    <p>Visitantes</p>
                </span>
            </li>
            <li>
                <i class='bx bxs-dollar-circle'></i>
                <span class="text">
                    <h3>2543</h3>
                    <p>Totales</p>
                </span>
            </li>
        </ul>

        <table>
            <thead>
                <tr>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Tipo de Documento</th>
                    <th>Número de Documento</th>
                    <th>País</th>
                    <th>Departamento</th>
                    <th>Municipio</th>
                    <th>Género</th>
                    <th>Edad</th>
                    <th>Grupo de Edad</th>
                    <th>Grupo Étnico</th>
                    <th>Discapacidad</th>
                    <th>Comunidad</th>
                    <th>Actividad</th>
                </tr>
            </thead>
            <tbody>
                {% for registro in registros %}
                <tr>
                    <td>{{ registro.nombres }}</td>
                    <td>{{ registro.apellidos }}</td>
                    <td>{{ registro.tipo_documento }}</td>
                    <td>{{ registro.numero_documento }}</td>
                    <td>{{ registro.pais }}</td>
                    <td>{{ registro.departamento }}</td>
                    <td>{{ registro.municipio }}</td>
                    <td>{{ registro.genero }}</td>
                    <td>{{ registro.edad }}</td>
                    <td>{{ registro.grupo_edad }}</td>
                    <td>{{ registro.grupo_etnico }}</td>
                    <td>{{ registro.discapacidad }}</td>
                    <td>{{ registro.comunidad }}</td>
                    <td>{{ registro.actividad }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>        
            </div>
        </div>        
    </main>
    <!-- CONTENIDO PRINCIPAL -->
</section>


<style>
    .texto-registro {
        text-align: center;
    }
</style>



<!-- Modal para ingresar detalles de la actividad -->
<div id="myModalActivity" class="modal" style="display: none;">
    <!-- Contenido del modal -->
    <div class="modal-content">
        <div class="modal-nav">
            <!-- Agrega más botones según sea necesario para más modales -->
        </div>
        <span class="close" id="closeModalBtnActivity" onclick="closeModal('myModalActivity')">&times;</span>
        <h2 class="texto-registro">Agregar Actividad</h2><br><br><br>
        
        <form id="modalActivityForm" onsubmit="asignarPersona(event)" action="/guardar_actividad" method="post">
            <!-- Agregamos el campo CSRF -->
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <!-- Aquí van los campos para ingresar los detalles de la actividad -->
            <label for="nombre_actividad"><b>Nombre de la Actividad:</b></label>
            <input type="text" id="nombre_actividad" name="nombre_actividad" class="form-control"><br><br>
            <label for="persona_encargada"><b>Persona Encargada:</b></label>
            <input type="text" id="persona_encargada" name="persona_encargada" class="form-control"><br><br>
            <label for="fecha_realizacion"><b>Fecha de Realización:</b></label>
            <input type="date" id="fecha_realizacion" name="fecha_realizacion" class="form-control"><br><br>
            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
    </div>
</div>


<!-- Modal 1 -->
<div id="myModal1" class="modal" style="display: none;">
    <!-- Modal content -->
    <div class="modal-content">
        <div class="modal-nav">
            <!-- Agrega más botones según sea necesario para más modales -->
        </div>
        <span class="close" id="closeModalBtn1" onclick="closeModal('myModal1')">&times;</span>
        <h2 class="texto-registro">REGISTRAR USUARIO</h2><br><br><br>
        
        <form id="modal1Form" action="/guardar_registro" method="post">
            <div style="display: flex; justify-content: space-between;">
                <div style="flex: 1; padding-right: 10px;">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <label for="nombres"><b>Nombres:</b></label>
                    <input type="text" id="nombres" name="nombres" class="form-control"><br><br>
                    <label for="apellidos"><b>Apellidos:</b></label>
                    <input type="text" id="apellidos" name="apellidos" class="form-control"><br><br>
                    <label for="tipo_documento"><b>Tipo de documento:</b></label>
                    <select name="tipo_documento" id="tipo_documento" class="form-control">
                        <option value="cedula">Cédula</option>
                        <option value="registro_civil">Registro Civil</option>
                        <option value="pasaporte">Pasaporte</option>
                        <option value="tarjeta_identidad">Tarjeta de Identidad</option>
                    </select><br><br>
                    <label for="numero_documento"><b>Número de documento:</b></label>
                    <input type="text" id="numero_documento" name="numero_documento" class="form-control"><br><br>
                    <label for="pais"><b>País:</b></label>
                    <select name="pais" id="pais" class="form-control">
                        <option value="Argentina">Argentina</option>
                        <option value="Bolivia">Bolivia</option>
                        <option value="Brazil">Brazil</option>
                        <option value="Chile">Chile</option>
                        <option value="Colombia">Colombia</option>
                        <option value="Costa Rica">Costa Rica</option>
                        <option value="Cuba">Cuba</option>
                        <option value="Dominican Republic">Dominican Republic</option>
                        <option value="Ecuador">Ecuador</option>
                        <option value="El Salvador">El Salvador</option>
                        <option value="Guatemala">Guatemala</option>
                        <option value="Haiti">Haiti</option>
                        <option value="Honduras">Honduras</option>
                        <option value="Mexico">Mexico</option>
                        <option value="Nicaragua">Nicaragua</option>
                        <option value="Panama">Panama</option>
                        <option value="Paraguay">Paraguay</option>
                        <option value="Peru">Peru</option>
                        <option value="Puerto Rico">Puerto Rico</option>
                        <option value="Uruguay">Uruguay</option>
                        <option value="Venezuela">Venezuela</option>
                    </select><br><br>
                    <label for="departamento"><b>Departamento:</b></label>
                    <select name="departamento" id="departamento" class="form-control">
                        <option value="">Seleccione un departamento</option>
                        <option value="Amazonas">Amazonas</option>
                        <option value="Antioquia">Antioquia</option>
                        <option value="Arauca">Arauca</option>
                        <option value="Atlántico">Atlántico</option>
                        <option value="Bolívar">Bolívar</option>
                        <option value="Boyacá">Boyacá</option>
                        <option value="Caldas">Caldas</option>
                        <option value="Caquetá">Caquetá</option>
                        <option value="Casanare">Casanare</option>
                        <option value="Cauca">Cauca</option>
                        <option value="Cesar">Cesar</option>
                        <option value="Chocó">Chocó</option>
                        <option value="Córdoba">Córdoba</option>
                        <option value="Cundinamarca">Cundinamarca</option>
                        <option value="Guainía">Guainía</option>
                        <option value="Guaviare">Guaviare</option>
                        <option value="Huila">Huila</option>
                        <option value="La Guajira">La Guajira</option>
                        <option value="Magdalena">Magdalena</option>
                        <option value="Meta">Meta</option>
                        <option value="Nariño">Nariño</option>
                        <option value="Norte de Santander">Norte de Santander</option>
                        <option value="Putumayo">Putumayo</option>
                        <option value="Quindío">Quindío</option>
                        <option value="Risaralda">Risaralda</option>
                        <option value="San Andrés y Providencia">San Andrés y Providencia</option>
                        <option value="Santander">Santander</option>
                        <option value="Sucre">Sucre</option>
                        <option value="Tolima">Tolima</option>
                        <option value="Valle del Cauca">Valle del Cauca</option>
                        <option value="Vaupés">Vaupés</option>
                        <option value="Vichada">Vichada</option>
                    </select><br><br>
                    <label for="municipio"><b>Municipio:</b></label>
                    <input type="text" id="municipio" name="municipio" class="form-control"><br><br>
                </div>
                <div style="flex: 1; padding-left: 10px;">
                    <label for="genero"><b>Género:</b></label>
                    <select name="genero" id="genero" class="form-control">
                        <option value="masculino">Masculino</option>
                        <option value="femenino">Femenino</option>
                        <option value="no_especifica">No Especifica</option>
                    </select><br><br>
                    <label for="edad"><b>Edad:</b></label>
                    <input type="number" id="edad" name="edad" class="form-control"><br><br>
                    <label for="grupo_edad"><b>Grupo de Edad:</b></label>
                    <select name="grupo_edad" id="grupo_edad" class="form-control">
                        <option value="menor_18">Menor de 18 años</option>
                        <option value="18_49">18 a 49 años</option>
                        <option value="50_mas">50 años en adelante</option>
                    </select><br><br>
                    <label for="grupo_etnico"><b>Grupo Étnico:</b></label>
                    <select name="grupo_etnico" id="grupo_etnico" class="form-control">
                        <option value="mestizo">Mestizo</option>
                        <option value="afro">Afro</option>
                        <option value="campesino">Campesino</option>
                        <option value="indigena">Indígena</option>
                    </select><br><br>
                    <label for="discapacidad"><b>Discapacidad:</b></label>
                    <select name="discapacidad" id="discapacidad" class="form-control">
                        <option value="si">Sí</option>
                        <option value="no">No</option>
                    </select><br><br>
                    <label for="comunidad"><b>Comunidad:</b></label>
                    <input type="text" id="comunidad" name="comunidad" class="form-control"><br><br>
                    <label for="actividad"><b>Actividad:</b></label>
                    <input type="text" id="actividad" name="actividad" class="form-control"><br><br>
                </div>
            </div><br>

            <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
    </div>
</div>


<script>
    // Función para abrir el modal
    function openModal(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = "block";
        }
    }
    
    // Función para cerrar el modal
    function closeModal(modalId) {
        var modal = document.getElementById(modalId);
        if (modal) {
            modal.style.display = "none";
        }
    }

    // Función para mostrar el formulario de registro de personas
    function openUserForm() {
        closeModal('myModalActivity'); // Cerramos el modal de actividad
        openModal('myModal1'); // Mostramos el modal de registro de usuario
    }

    // Función para asignar la actividad y mostrar el formulario de registro de personas
    function asignarPersona(event) {
        event.preventDefault(); // Evitar que el formulario se envíe automáticamente
        
        // Validar los campos del formulario de actividad
        var nombreActividad = document.getElementById("nombre_actividad").value;
        var fechaRealizacion = document.getElementById("fecha_realizacion").value;
        
        // Verificar que los campos obligatorios no estén vacíos
        if (nombreActividad.trim() === '' || fechaRealizacion.trim() === '') {
            alert("Por favor, complete todos los campos de la actividad.");
            return;
        }
        
        // Enviar los datos del formulario de actividad al servidor utilizando Fetch API
        var formData = new FormData(document.getElementById("modalActivityForm"));
        fetch('/guardar_actividad', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRF-Token': '{{ csrf_token() }}' // Agregar el token CSRF si es necesario
            }
        })
        .then(response => {
            if (response.ok) {
                // Los datos se guardaron correctamente, mostrar el formulario de registro de usuario
                openUserForm();
                
                // Procesar los datos del nuevo registro
                response.json().then(data => {
                    // Crear una nueva fila de la tabla con los datos del nuevo registro
                    var newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${data.nombres}</td>
                        <td>${data.apellidos}</td>
                        <td>${data.tipo_documento}</td>
                        <td>${data.numero_documento}</td>
                        <td>${data.pais}</td>
                        <td>${data.departamento}</td>
                        <td>${data.municipio}</td>
                        <td>${data.genero}</td>
                        <td>${data.edad}</td>
                        <td>${data.grupo_edad}</td>
                        <td>${data.grupo_etnico}</td>
                        <td>${data.discapacidad}</td>
                        <td>${data.comunidad}</td>
                        <td>${data.actividad}</td>
                    `;
                    
                    // Insertar la nueva fila en la tabla existente (al final del cuerpo de la tabla)
                    var tableBody = document.querySelector('.table-data table tbody');
                    tableBody.appendChild(newRow);
                });
            } else {
                // Hubo un error al guardar los datos, mostrar un mensaje de error
                alert('Error al guardar los datos de la actividad.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error al comunicarse con el servidor.');
        });
    }
</script>




{% endblock %}




<div class="table-data">
    <div class="order">
        <div class="head">
            <h3>Registros recientes</h3>
            <i class='bx bx-search'></i>
            <i class='bx bx-filter'></i>
        </div>
        <table>
            <thead>
                <tr>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Tipo de Documento</th>
                    <th>Número de Documento</th>
                    <th>País</th>
                    <th>Departamento</th>
                    <th>Municipio</th>
                    <th>Género</th>
                    <th>Edad</th>
                    <th>Grupo de Edad</th>
                    <th>Grupo Étnico</th>
                    <th>Discapacidad</th>
                    <th>Comunidad</th>
                    <th>Actividad</th>
                </tr>
            </thead>
            <tbody>
                <!-- Aquí se mostrarán los registros de usuarios dinámicamente -->
            </tbody>
        </table>
    </div>
</div>
