<script>
    // Función para abrir el modal
    function openModal(modalId) {
        var modal = document.getElementById(modalId);
        modal.style.display = "block";
    }

    // Función para cerrar el modal
    function closeModal(modalId) {
        var modal = document.getElementById(modalId);
        modal.style.display = "none";
    }

    // Función para actualizar la tabla de proyectos desde el servidor
    function actualizarTablaProyectos() {
        fetch('/get_datos_tabla_proyectos')
            .then(response => response.json())
            .then(data => {
                renderTablaProyectos(data);
            });
    }

    // Función para renderizar la tabla de proyectos
    function renderTablaProyectos(data) {
        var tableBody = document.querySelector('.table-data table tbody');
        tableBody.innerHTML = "";

        data.forEach(rowData => {
            var newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${rowData.nombre}</td>
                <td>${rowData.descripcion}</td>
                <td>${rowData.cluster}</td>
                <td>${rowData.responsable}</td>
                <td>${rowData.fecha_inicio}</td>
                <td>${rowData.fecha_finalizacion}</td>
                <td class="status ${rowData.estado.toLowerCase()}">${rowData.estado}</td>
                <td>
                    <a href="#" class="custom-btn" onclick="editarProyecto(${rowData.id})">Gestionar Proyecto</a>
                    <a href="#" class="custom-btn-eliminar" data-proyecto-id="${rowData.id}">Eliminar</a>
                </td>
            `;
            tableBody.appendChild(newRow);
        });
    }

    // Llamar a la función para actualizar la tabla de proyectos al cargar la página
    window.addEventListener('load', function() {
        actualizarTablaProyectos();
    });

    document.getElementById("cluster_select_option").addEventListener("change", function() {
        var clusterSelectOption = document.getElementById("cluster_select_option");
        var clusterText = document.getElementById("cluster_text");
        if (clusterSelectOption.value === "nuevo") {
            clusterText.style.display = "block";
        } else {
            clusterText.style.display = "none";
        }
    });

    // Función para editar un proyecto
    function editarProyecto(proyectoId) {
        // Redirigir al usuario a la página de edición del proyecto con el ID del proyecto
        window.location.href = `/editar_proyecto/${proyectoId}`;
    }

    // Función para actualizar las estadísticas de proyectos
    function actualizarEstadisticasProyectos() {
        fetch('/get_estadisticas_proyectos')
            .then(response => response.json())
            .then(data => {
                document.getElementById('proyectos-registrados').textContent = data.registrados;
                document.getElementById('proyectos-activos').textContent = data.activos;
                document.getElementById('proyectos-terminados').textContent = data.terminados;
            });
    }

    // Llamar a la función para actualizar las estadísticas de proyectos al cargar la página
    window.addEventListener('load', function() {
        actualizarEstadisticasProyectos();
    });

    // Funcionalidad de búsqueda
    document.getElementById('search-input').addEventListener('input', function() {
        var searchTerm = this.value.toLowerCase();
        var rows = document.querySelectorAll('.table-data table tbody tr');

        rows.forEach(row => {
            var nombre = row.children[0].textContent.toLowerCase();
            var descripcion = row.children[1].textContent.toLowerCase();

            if (nombre.includes(searchTerm) || descripcion.includes(searchTerm)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
